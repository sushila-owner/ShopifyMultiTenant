import javax.crypto.Mac;
import javax.crypto.spec.SecretKeySpec;
import java.nio.charset.StandardCharsets;
import java.security.InvalidKeyException;
import java.security.NoSuchAlgorithmException;
import java.util.Base64;

/**
 * api sign tool
 */
public class ApiSignUtil {
    public static final String NAME = "HmacSHA256";

    /**
     * encrypt
     *
     * @param message (input parameters)
     * @param secretKey (secret key)
     * @return  (return encrypted value)
     */
    public static String encrypt(String message, String secretKey) {
        try {
            // create HMAC-SHA256  sample
            Mac hmacSHA256 = Mac.getInstance(NAME);
            // create secret key specifications
            SecretKeySpec spec = new SecretKeySpec(secretKey.getBytes(StandardCharsets.UTF_8), NAME);
            //  initialize HmacSHA256  sample
            hmacSHA256.init(spec);
            byte[] bytes = hmacSHA256.doFinal(message.getBytes(StandardCharsets.UTF_8));
            // convert to hexadecimal
            StringBuilder hexStr = new StringBuilder();
            for (byte b : bytes) {
                hexStr.append(String.format("%02x", b));
            }
            return hexStr.toString();
        } catch (NoSuchAlgorithmException | InvalidKeyException e) {
            throw new RuntimeException(e);
        }
    }

    /**
     * access sign
     * @param clientId clientId
     * @param timestamp 
     * @param nonce (10 digit random string)
     * @param uri (request url)
     * @param clientSecret clientSecret
     * @return api (return API sign)
     */
    public String getApiSign(String clientId, Long timestamp, String nonce, String uri, String clientSecret) {
        String msg = clientId + "&" + uri + "&" + timestamp + "&" + nonce;
        String key = clientId + "&" + clientSecret + "&" + nonce;
        byte[] result = encrypt(msg, key).getBytes(StandardCharsets.UTF_8);
        return Base64.getEncoder().encodeToString(result);
    }

    public static void main(String[] args) {
        String clientId = "123456789";
        String clientSecret = "123456789";
        String uri = "/api/v1/test";
        String nonce = "1234567890";
        Long timestamp = System.currentTimeMillis();
        String apiSign = new ApiSignUtil().getApiSign(clientId, timestamp, nonce, uri, clientSecret);
        System.out.println(apiSign);
    }
}